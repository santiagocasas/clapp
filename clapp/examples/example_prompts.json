[
  {
    "id": "lensed_tt_plot",
    "prompt": "Plot the lensed CMB TT spectrum for a basic LCDM model.",
    "code": "import numpy as np\nimport matplotlib.pyplot as plt\nfrom classy import Class\n\n# Initialize CLASS\ncosmo = Class()\n\n# Set up a basic LCDM model with explicit reionization optical depth\nparams = {\n    'omega_b': 2.255065e-02,     # Baryon density\n    'omega_cdm': 1.193524e-01,   # Cold dark matter density\n    'H0': 67.76953,              # Hubble constant\n    'A_s': 2.123257e-09,         # Primordial amplitude\n    'n_s': 0.9686025,            # Spectral index\n    'tau_reio': 0.092528,        # Reionization optical depth\n    'output': 'tCl,pCl,lCl',     # Output CMB and lensing spectra\n    'lensing': 'yes',            # Include CMB lensing\n    'l_max_scalars': 2500,       # Maximum multipole\n}\n\n# Set and compute\ncosmo.set(params)\ncosmo.compute()\n\n# Get lensed CMB Cls\nlensed_cl = cosmo.lensed_cl()\nell = lensed_cl['ell']\ntt_spectrum = lensed_cl['tt']  # C_ell\n\n# Convert to D_ell = ell*(ell+1)*C_ell/(2*pi) [in muK^2]\nD_ell_TT = ell * (ell + 1) * tt_spectrum * 1e12 / (2 * np.pi)  # Convert from K^2 to muK^2\n\n# Plot\nplt.figure(figsize=(10, 6))\nplt.plot(ell, D_ell_TT, 'b-', linewidth=1.5, label='Lensed TT')\nplt.title(r'Lensed CMB TT Spectrum - $\\Lambda$CDM')\nplt.xlabel(r'Multipole $\\ell$')\nplt.ylabel(r'$D_\\ell^{TT} \\; [\\mu \\mathrm{K}^2]$')\nplt.grid(True, which='both', linestyle='--', alpha=0.6)\nplt.xlim(2, 2500)\nplt.ylim(bottom=0)\nplt.legend()\nplt.tight_layout()\nplt.savefig('lensed_cmb_tt_spectrum.png', dpi=150)\nplt.close()\n"
  },
  {
    "id": "planck_age",
    "prompt": "Run classy for a Planck 2018 cosmology and compute the age of the Universe.",
    "code": "from classy import Class\n\n# Initialize CLASS\ncosmo = Class()\n\n# Set cosmology to Planck 2018 best-fit\ncosmo.set({\n    'output': 'tCl, mPk',\n    'Omega_b': 0.05,\n    'Omega_cdm': 0.25,\n    'h': 0.7,\n    'A_s': 2.1e-9,\n    'n_s': 0.96,\n    'tau_reio': 0.055,\n    'P_k_max_1/Mpc': 10.0,\n    'l_max_scalars': 5000\n})\n\n# Compute the model\ncosmo.compute()\n\n# Get the age of the Universe in Gigayears\nage_Gyr = cosmo.age()  # Returns age in Gigayears (Gyr)\n\n# Print result\nprint(f\"Age of the Universe (Planck 2018 cosmology): {age_Gyr:.3f} Gyr\")\n\n# Get redshift of matter-radiation equality using the get_current_derived_parameters method\nz_eq = cosmo.get_current_derived_parameters(['z_eq'])['z_eq']\nprint(f\"Redshift of matter-radiation equality: z_eq = {z_eq:.2f}\")\n"
  },
  {
    "id": "halofit_z1",
    "prompt": "Plot the linear vs. nonlinear halofit matter power spectrum for z=1.0.",
    "code": "import numpy as np\nimport matplotlib.pyplot as plt\nfrom classy import Class\n\n# Define k range in 1/Mpc\nk_min = 1e-4\nk_max = 1.0\nnk = 200\nk_list = np.logspace(np.log10(k_min), np.log10(k_max), nk)\n\n# Redshift\nz = 1.0\n\n# Initialize CLASS for linear P(k)\ncosmo = Class()\n\n# Set basic LCDM parameters (Planck-like)\nparams = {\n    'omega_b': 0.022382,\n    'omega_cdm': 0.120107,\n    'h': 0.6732,\n    'A_s': 2.100549e-9,\n    'n_s': 0.966049,\n    'tau_reio': 0.054388,\n    'output': 'mPk',\n    'P_k_max_1/Mpc': k_max,\n    'z_pk': z,\n}\n\n# === Linear power spectrum ===\nparams_lin = params.copy()\nparams_lin['non_linear'] = 'no'\ncosmo.set(params_lin)\ncosmo.compute()\n\npk_lin = []\nfor k in k_list:\n    pk_lin.append(cosmo.pk(k, z))\n\n# === Nonlinear power spectrum (Halofit) ===\nparams_nl = params.copy()\nparams_nl['non_linear'] = 'halofit'\ncosmo.set(params_nl)\ncosmo.compute()\n\npk_nl = []\nfor k in k_list:\n    pk_nl.append(cosmo.pk(k, z))\n\n# Clean up\ncosmo.struct_cleanup()\ncosmo.empty()\n\n# Convert to numpy arrays\npk_lin = np.array(pk_lin)\npk_nl = np.array(pk_nl)\n\n# Plot\nplt.figure(figsize=(10, 6))\nplt.plot(k_list, pk_lin, 'b-', label='Linear', linewidth=2)\nplt.plot(k_list, pk_nl, 'r-', label='Nonlinear (Halofit)', linewidth=2)\nplt.plot(k_list, pk_nl / pk_lin, 'g--', label='Ratio (NL / Lin)', linewidth=1.5)\n\nplt.xscale('log')\nplt.yscale('log')\nplt.xlabel(r'Wavenumber $k \\; [\\mathrm{Mpc}^{-1}]$')\nplt.ylabel(r'Matter Power Spectrum $P(k) \\; [\\mathrm{Mpc}^3]$')\nplt.title(r'Matter Power Spectrum at $z = 1.0$')\nplt.legend()\nplt.grid(True, which='both', linestyle='--', alpha=0.6)\nplt.tight_layout()\nplt.savefig('pk_linear_vs_halofit_z1.pdf')\nplt.savefig('pk_linear_vs_halofit_z1.png', dpi=150)\nplt.close()\n"
  },
  {
    "id": "sigma8_contour",
    "prompt": "Create a colored 2D contour plot of sigma8(z=0) as a function of Omegam (x-axis) and H0 (y-axis).",
    "code": "import numpy as np\nimport matplotlib.pyplot as plt\nfrom classy import Class\n\n# Fixed parameters (Planck-like)\nomega_b = 0.022382\nA_s = 2.100549e-9\nn_s = 0.966049\ntau_reio = 0.054388\n\n# Parameter ranges\nN = 10\nomega_m_list = np.linspace(0.28, 0.36, N)   # Around Planck best-fit (+/- ~10%)\nh0_list = np.linspace(60, 75, N)            # H0 in km/s/Mpc\n\n# Grid for sigma8\nsigma8_grid = np.zeros((N, N))\n\n# Compute sigma8 for each (Omega_m, H0)\nfor i, omega_m in enumerate(omega_m_list):\n    for j, h0 in enumerate(h0_list):\n        h = h0 / 100.0\n        omega_cdm = omega_m * h**2 - omega_b  # Omega_cdm = Omega_m h^2 - omega_b\n        if omega_cdm <= 0:\n            sigma8_grid[j, i] = np.nan\n            continue\n\n        cosmo = Class()\n        cosmo.set({\n            'omega_b': omega_b,\n            'omega_cdm': omega_cdm,\n            'h': h,\n            'A_s': A_s,\n            'n_s': n_s,\n            'tau_reio': tau_reio,\n            'output': 'mPk',\n            'P_k_max_1/Mpc': 1.0,\n            'z_max_pk': 0.0\n        })\n        cosmo.compute()\n        sigma8_grid[j, i] = cosmo.sigma8()\n        cosmo.struct_cleanup()\n        cosmo.empty()\n\n# Create colored contour plot\nplt.figure(figsize=(8, 6))\nX, Y = np.meshgrid(omega_m_list, h0_list)\ncmap = plt.cm.viridis\nCSF = plt.contourf(X, Y, sigma8_grid, levels=50, cmap=cmap, alpha=0.9)\nCS = plt.contour(X, Y, sigma8_grid, levels=10, colors='black', linewidths=0.8)\nplt.clabel(CS, inline=True, fontsize=8, fmt='%.3f')\nplt.colorbar(CSF, label=r'$\\sigma_8(z=0)$')\nplt.xlabel(r'$\\Omega_m$')\nplt.ylabel(r'$H_0 \\; [\\mathrm{km/s/Mpc}]$')\nplt.title(r'$\\sigma_8(z=0)$ - Colored Contours')\nplt.grid(True, alpha=0.5)\nplt.tight_layout()\nplt.savefig('sigma8_contour_colored.pdf')\nplt.savefig('sigma8_contour_colored.png', dpi=150)\nplt.close()\n"
  },
  {
    "id": "growth_factor_three",
    "prompt": "Compute the scale-independent growth factor for three cosmologies as a function of z; Planck18, LCDM + m_nu=0.2eV and a DESI-like dynamical DE.",
    "code": "import numpy as np\nimport matplotlib.pyplot as plt\nfrom classy import Class\n\n# Redshift range\nzmax = 4\nzmin = 0\nnz = 200\nz = np.linspace(zmin, zmax, nz)\n\n# 1. Planck 2018-like LCDM\nparams_lcdm = {\n    'omega_b': 0.022382,\n    'omega_cdm': 0.120107,\n    'h': 0.6736,\n    'A_s': 2.1e-9,\n    'n_s': 0.9649,\n    'tau_reio': 0.0543,\n    'output': 'mPk',\n    'P_k_max_h/Mpc': 10\n}\n\n# 2. LCDM + massive neutrinos: sum m_nu = 0.2 eV\nparams_nu = params_lcdm.copy()\nparams_nu['m_ncdm'] = 0.2\nparams_nu['N_ncdm'] = 1\n\n# 3. DESI-like w0waCDM: w0 = -0.42, wa = -1.75\nparams_desi = params_lcdm.copy()\nparams_desi['Omega_fld'] = -1  # Let CLASS compute Omega_Lambda\nparams_desi['w0_fld'] = -0.42\nparams_desi['wa_fld'] = -1.75\nparams_desi['fluid_equation_of_state'] = 'CLP'\nparams_desi['use_ppf'] = 'yes'\nparams_desi['P_k_max_h/Mpc'] = 10\n\n# Function to compute f(z) array using scale_independent_growth_factor_f\ndef get_fz(params, z):\n    cosmo = Class()\n    cosmo.set(params)\n    cosmo.compute()\n\n    f_z = np.array([cosmo.scale_independent_growth_factor_f(zi) for zi in z])\n\n    cosmo.struct_cleanup()\n    cosmo.empty()\n    return f_z\n\n# Compute f(z) for each model\nf1 = get_fz(params_lcdm, z)\nf2 = get_fz(params_nu, z)\nf3 = get_fz(params_desi, z)\n\n# Plot\nplt.figure(figsize=(8, 6))\nplt.plot(z, f1, label='Planck 2018 $\\Lambda$CDM', color='blue')\nplt.plot(z, f2, label='$\\Lambda$CDM + $m_\\nu=0.2\\ \\mathrm{eV}$', color='green', linestyle='--')\nplt.plot(z, f3, label='DESI-like $w_0=-0.42,\\ w_a=-1.75$', color='red', linestyle='-.')\nplt.xlabel('Redshift $z$', fontsize=12)\nplt.ylabel('Growth rate $f(z) = d\\ln D / d\\ln a$', fontsize=12)\nplt.title('Cosmic Growth Rate $f(z)$ for Different Cosmologies', fontsize=14)\nplt.legend(fontsize=11)\nplt.grid(True)\nplt.xlim(0, 4)\nplt.ylim(0, 1.1)\n\n# Save plot\nplt.savefig(\"growth_rate_f_z_better.png\", dpi=200)\nplt.close()\n\nprint(\"Plot saved as 'growth_rate_f_z_better.png'\")\n"
  }
]
